# Troubleshooting Guide

Below are a list of issues that you may face while setting up or running the Document Extraction Libraries and their solutions.

## Pre-requisite software installation issues:
- If you encounter errors related to `JAVA_HOME`, `MAVEN_HOME`, or `python_path` not being set in environment variables, follow these steps to set them:
    - Open the Start Menu, search for "Environment Variables", and select either `Edit environment variables for your account` or `Edit the system environment variables`.
    - In the Environment Variables window, add or update the following variables:
        - **JAVA_HOME**: Set this to the path of your JDK installation (e.g., `C:\ProgramFiles\openjdk-20.0.1\jdk-20.0.1`).
        - **MAVEN_HOME**: Set this to the path of your Maven installation (e.g., `C:\ProgramFiles\apache-maven-3.9.6\bin`).
        - **python_path**: Add the path to your Python installation to the `Path` variable (e.g., `C:\Program Files\Python311\python.exe`).

## Incorrect python version:
- Check for version of python available on PATH

    ```dos
    python --version
    # Python X.X.X
    ```

- If python is not available or incorrect version is showing up, then do the following **whenever opening a new command prompt**.
    1. Identify the correct location of python E.g. `C:\Program Files\Python310\python.exe`.
    2. In command prompt, run the following: `set PATH="C:\Program Files\Python310";%PATH%`  
        > Note: Do NOT include `\python.exe` in the above command

## Model `tessdata` download failed:
- Error: 
    - Model `tessdata` download failed
- Solution:
    - Create the directory containing the model files .i.e. `C:\del\ai\models\tessdata`.
    - The model files are of the format `*.traineddata`. E.g. `eng.traineddata`
    - The language-specific model files can be downloaded from https://github.com/tesseract-ocr/tessdata
    - After copying language-specific model files verify if `C:\del\ai\models\tessdata\eng.traineddata` path exist.

## `NLTK data` issue: SSL:CERTIFICATE_VERIFY_FAILED: 
- Error: 
    ```
    [nltk_data] Error loading punkt: <urlopen error [SSL:
    [nltk_data]     CERTIFICATE_VERIFY_FAILED] certificate verify failed:
    [nltk_data]     Basic Constraints of CA cert not marked critical
    [nltk_data]     (_ssl.c:1028)>
    [nltk_data] Error loading stopwords: <urlopen error [SSL:
    [nltk_data]     CERTIFICATE_VERIFY_FAILED] certificate verify failed:
    [nltk_data]     Basic Constraints of CA cert not marked critical
    [nltk_data]     (_ssl.c:1028)>
    ```
- Solution:
    - Create a parent directory at the following path `C:\del\ai\nltk_data`.
    - Inside the parent directory i.e `C:\del\ai\nltk_data`, create two subdirectories named `corpora` and `tokenizers`.
    - Navigate to the following URL on you browser: `https://www.nltk.org/nltk_data/`
    - Search for and download the following zip files from the above URL: 
        1. `Stopwords Corpus`: id = stopwords
        2. `Punkt Tokenizer Models`: id = punkt
    - Extract the contents of the downloaded zip files into the respective directories and verify if the following paths exist:
        - `C:\del\ai\nltk_data\corpora\stopwords`
        - `C:\del\ai\nltk_data\tokenizers\punkt`

## `tiktoken` issue: SSLError CERTIFICATE_VERIFY_FAILED:
- Error: 
    ```
   HTTPSConnectionPool(host='openaipublic.blob.core.windows.net', port=443):Max retries exceeded with url: /encodings/p50k_base.tiktoken (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed:unable to get local issuer certificate (_ssl.c:992)
    ```
- Solution:
    - Please open tiktoken url (here https://openaipublic.blob.core.windows.net/encodings/p50k_base.tiktoken) in a browser, it will automatically download a file.
    - Keep that file in `C:\del\ai\models\tiktoken_encoding`
    - Rename the file with it's hash value i.e. ec7223a39ce59f226a68acc30dc1af2788490e15  
    Hash name of a file can be generated by running below python code.
        ```python
        #For tiktoken issue:
        import hashlib
        x="https://openaipublic.blob.core.windows.net/encodings/p50k_base.tiktoken"
        hashlib.sha1(x.encode()).hexdigest()
        #ec7223a39ce59f226a68acc30dc1af2788490e15
        ```

## Model `all-MiniLM-L6-v2` download failed:
- Error: 
    - Model `all-MiniLM-L6-v2` download failed
- Solution:
    - Download `all-MiniLM-L6-v2`pretrained model by following https://pypi.org/project/sentence-transformers/ to `C:\del\ai\models` and keep folder name same as model name e.g.`C:\del\ai\models\all-MiniLM-L6-v2`
    - After copying model verify it by cheking if this path exist `C:\del\ai\models\all-MiniLM-L6-v2\pytorch_model.bin`

## `fbgemm.dll` not found:
- Error: 
    ```
    [WinError 126] The specified module could not be found. Error loading 
    "\.venv\Lib\site-packages\torch\lib\fbgemm.dll" or one of its dependencies.
    ```
- Solution:
    ```
    !pip install --upgrade torchvision==0.18.1
    ```
